<!DOCTYPE html>
<html>
<head>
  <title>EduPickup App – Parent</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="edupickuplogo.png">
 <link rel="apple-touch-icon" href="edupickuplogo.png">

</head>
<body>
  <h2>Ridicare copil - Check in <div style="text-align:center; margin-bottom:25px;margin-top: 10px;">
    <img src="edupickuplogo.png" alt="EduPickup Logo" style="max-width:100px; height:auto;">
  </div></h2>
  <div id="main"></div>
  
  

  <script>
    const API_BASE = 'https://unwailed-creepier-cory.ngrok-free.dev';

    const demoChildren = [
      {id: 'c1', name: 'Sacelean Sara'},
      {id: 'c2', name: 'Ana Popescu'},
      {id: 'c3', name: 'Lucas Georgescu'},
      {id: 'c4', name: 'Tudor Dobre'},
      {id: 'c5', name: 'Vlad Stan'},
      {id: 'c6', name: 'Sara Pavel'},
      {id: 'c7', name: 'Radu Enache'},
      {id: 'c8', name: 'Eddie Munteanu'},
      {id: 'c9', name: 'Darius Ilie'},
      {id: 'c10',name: 'Ionescu Maria'}
    ];

    const $ = (s) => document.querySelector(s);

    const humanTime = (iso) => {
      const d = new Date(iso);
      return isNaN(d.getTime()) ? '🕓 dată invalidă' : d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    };

    function normalizeName(name) {
      return name
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, '') // remove accents
        .replace(/\s+/g, ' ')            // collapse multiple spaces
        .trim();
    }

    function showParent() {
      $('#main').innerHTML = `
        <div>
          <label>Nume copil (nume + prenume)</label><br/>
          <input type="text" id="childInput" placeholder="ex: Ionescu Maria"><br/><br/>

          <label>Cine ridică?</label><br/>
          <select id="whoSelect">
            <option>Tată</option>
            <option>Mamă</option>
            <option>Bunică</option>
            <option>Altă persoană</option>
          </select><br/><br/>

          <label>Notă (opțional)</label><br/>
          <input type="text" id="noteInput" placeholder="ex: vine cu bunica"><br/><br/>

          <button id="checkInBtn">Sunt la poarta </button>
          <div id="confirm" style="margin-top:10px; display:none; padding:12px; background:#e6f7ff; border-left:4px solid #4a90e2; border-radius:6px;"></div>
        </div>
      `;

      $('#checkInBtn').addEventListener('click', async () => {
        const fullName = $('#childInput').value.trim();
        const who = $('#whoSelect').value;
        const note = $('#noteInput').value.trim();
        const inputName = normalizeName(fullName);
        const child = demoChildren.find(c => normalizeName(c.name) === inputName);

        if (!child) {
          $('#confirm').style.display = 'block';
          $('#confirm').innerHTML = `<div style="color:red">❌ Numele copilului nu este cunoscut. Verifică să fie complet și corect: Nume familie + Prenume.</div>`;
          return;
        }

        const evt = {
          child_id: child.id,
          child_name: child.name,
          who,
          note,
          status: 'arrived'
        };

        const res = await fetch(`${API_BASE}/events`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(evt)
        });

        const saved = await res.json();
        $('#confirm').style.display = 'block';
        $('#confirm').innerHTML = `
          ✅ Ai raportat sosirea pentru <strong>${saved.child_name}</strong> la ${humanTime(saved.ts)}.<br/>
          Așteaptă lângă poartă.
        `;
        $('#noteInput').value = '';
        $('#childInput').value = '';
      });
    }

    showParent();
  </script>
  <script>
    function checkCookies() {
        const cookieBanner = document.getElementById('cookie-banner');
        const cookiesAccepted = localStorage.getItem('cookiesAccepted');

        if (!cookiesAccepted) {
            cookieBanner.style.display = 'block';
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookiesAccepted', 'true');
        document.getElementById('cookie-banner').style.display = 'none';
    }  
</script>  
 <footer style="text-align:center; padding:20px; font-size:14px; color:#faf4f4;">
  &copy; 2025 EduPickup. All rights reserved.
</footer>

</body>
</html>
